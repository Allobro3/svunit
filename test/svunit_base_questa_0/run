# create the Makefile
create_svunit.pl

which vcsi >/dev/null
if [ "$?" != "0" ]; then
  exit 1;
fi

# build and run svunit with vcsi
make


# check the log output for a PASS from the testrunner
if [ ! -e run.log ]; then
  echo run.log does not exist
  exit 1;
fi

grep "INFO:  \[0\]\[dut_ut\]: Use the INFO macro" run.log >/dev/null
if [ "$?" != "0" ]; then
  echo INFO not detected from unit test in run.log
  exit 1;
fi

grep "ERROR: \[0\]\[dut_ut\]: Use the ERROR macro" run.log >/dev/null
if [ "$?" != "0" ]; then
  echo ERROR not detected from unit test in run.log
  exit 1;
fi

grep "dut_ut::strictly_so_the_teardown_is_called::FAILED" run.log >/dev/null
if [ "$?" != "0" ]; then
  exit 1;
fi

grep "dut_ut::FAILED" run.log >/dev/null
if [ "$?" != "0" ]; then
  exit 1;
fi

grep "ts::FAILED" run.log >/dev/null
if [ "$?" != "0" ]; then
  exit 1;
fi

grep "Testrunner::FAILED" run.log >/dev/null
if [ "$?" != "0" ]; then
  exit 1;
fi

exit 0
