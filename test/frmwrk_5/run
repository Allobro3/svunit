# remove and create the unit_test
create_unit_test.pl -overwrite -out ./another_test/test0_unit_test.sv ./another_test/test0.sv

# create the Makefile
create_svunit.pl

# verify that nothing from another_test/empty_dir gets into the Makefil
grep empty_dir Makefile
if [ "$?" == "0" ]; then
  echo found reference to another_test/empty_dir in Makefile
  exit 1;
fi

# cd to the child dir
cd another_test

# build the svunit_top
make .svunit_top.sv

# massage the testsuite golden reference
TS_TYPE=`pwd | sed -e "s/[\/-]/_/g"`_testsuite
TS_INST=`pwd | sed -e "s/[\/-]/_/g"`_ts
sed -e "s/TS_TYPE/$TS_TYPE/g" testsuite.gold | sed -e "s/TS_INST/$TS_INST/g" > .testsuite.gold
sed -e "s/TS_TYPE/$TS_TYPE/g" testrunner.gold | sed -e "s/TS_INST/$TS_INST/g" > .testrunner.gold



# do the checking
gold=(  test0_unit_test.gold    .testsuite.gold   .testrunner.gold )
check=( test0_unit_test.sv      .$TS_TYPE.sv      .testrunner.sv   )
for i in {0..2}; do
  if [ "`diff -bB ${gold[$i]} ${check[$i]}`" != "" ]; then
    echo ${check[$i]} failed;
    exit 1;
  fi
done
